<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Color-Coded Bible</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Hebrew&display=swap" rel="stylesheet">
    <style>
       :root {
  --background-color: #f5f7fa;
  --text-color: #34495e;
  --hover-color: #e0e6ed;
}

body {
  font-family: 'Noto Sans Hebrew', 'Roboto', sans-serif;
  background-color: var(--background-color);
  margin: 0;
  padding: 20px;
  line-height: 1.8;
  color: var(--text-color);
}

h1 {
  text-align: center;
  color: #333;
  font-size: 2.5rem;
  margin-bottom: 1.5rem;
}

.filter-buttons, .book-filter {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 10px;
  margin-bottom: 30px;
}

.filter-buttons button, .book-filter button {
  border: none;
  padding: 12px 24px;
  cursor: pointer;
  font-size: 1rem;
  border-radius: 50px;
  transition: all 0.3s ease;
  color: black;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.filter-buttons button:hover, .book-filter button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

/* Device Color Classes - preserved from original */
.device-waw-explicativum, .device-waw-explicativum.filter-buttons button { background-color: #90EE90; } /* LightGreen - fresh, positive */
.device-hendiadys, .device-hendiadys.filter-buttons button { background-color: #ADD8E6; } /* LightBlue - calm, peaceful */ 
.device-synecdoche, .device-synecdoche.filter-buttons button { background-color: #FFA07A; } /* LightSalmon - warm, inviting */
.device-hapax, .device-hapax.filter-buttons button { background-color: #87CEFA; } /* LightSkyBlue - airy, spacious */ 
.device-merism, .device-merism.filter-buttons button { background-color: #FFB6C1; } /* LightPink - soft, gentle */
.device-wordplay, .device-wordplay.filter-buttons button { background-color: #FFFACD; } /* LemonChiffon - bright, cheerful */
.device-euphemism, .device-euphemism.filter-buttons button { background-color: #E0FFFF; } /* LightCyan - tranquil, serene */
.device-simile, .device-simile.filter-buttons button { background-color: #DDA0DD; } /* Plum - sophisticated, elegant */ 
.device-ambiguity, .device-ambiguity.filter-buttons button { background-color: #FA8072; } /* Salmon - noticeable, but not harsh */

.device-waw-explicativum .highlight,
.device-hendiadys .highlight,
.device-synecdoche .highlight,
.device-merism .highlight,
.device-wordplay .highlight,
.device-euphemism .highlight,
.device-simile .highlight,
.device-hapax .highlight,
.device-ambiguity .highlight {
  font-weight: bold;
}

.verses {
  max-width: 800px;
  margin: 0 auto;
  background-color: white;
  padding: 30px;
  border-radius: 15px;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
}

.verse {
  margin-bottom: 30px;
  padding: 20px 50px 20px 20px; /* Adjusted padding */
  border-bottom: 1px solid #ecf0f1;
  transition: all 0.3s ease;
  position: relative;
  text-align: center; /* Center the text */
  display: flex;
  flex-direction: column;
  align-items: center; /* Center child elements horizontally */
  justify-content: center; /* Center child elements vertically */
}

.verse:hover {
  background-color: var(--hover-color);
  transform: translateY(-5px);
  box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.verse-plus-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 30px;
  height: 30px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 20px;
  text-align: center;
  line-height: 30px;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

.verse-plus-btn:hover {
  background-color: #45a049;
  transform: rotate(90deg);
}


footer {
  text-align: center;
  margin-top: 30px;
  color: #7f8c8d;
  font-size: 0.9rem;
}

.superscript {
  font-size: 0.7em;
  vertical-align: super;
}

.source-block {
  margin-top: 15px;
  font-size: 0.9rem;
}

.source-block a {
  color: #6A0DAD;
  text-decoration: none;
  transition: color 0.3s ease;
}

.source-block a:hover {
  color: #4B0082;
}

#toggleFormBtn {
  position: absolute;
  top: 10px;
  right: 10px;
  background-color: #f44336;
  color: white;
  border: none;
  padding: 5px 15px;
  font-size: 16px;
  cursor: pointer;
  border-radius: 5px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

#toggleFormBtn:hover {
  background-color: #d32f2f;
  transform: translateY(-2px);
  box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
}

#formContainer {
  position: fixed;
  left: 10px;
  top: 150px;
  width: 400px;
  max-width: 90%;
  display: none;
  z-index: 1000;
  background-color: white;
  border-radius: 15px;
  padding: 20px;
  box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
  padding-top: 50px;
}

iframe {
  width: 100%;
  height: 300px;
  border: none;
  border-radius: 10px;
}

.verse-plus-btn {
  position: absolute;
  top: 10px;
  right: 10px;
  width: 30px;
  height: 30px;
  background-color: #4CAF50;
  color: white;
  border: none;
  border-radius: 50%;
  font-size: 20px;
  text-align: center;
  line-height: 30px;
  cursor: pointer;
  z-index: 10;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  transition: all 0.3s ease;
}

@media (max-width: 768px) {
  body {
    padding: 10px;
  }

  h1 {
    font-size: 2rem;
  }

  .filter-buttons button, .book-filter button {
    padding: 10px 20px;
    font-size: 0.9rem;
  }

  #formContainer {
    left: 5px;
    top: 120px;
    width: calc(100% - 10px);
  }

  #toggleFormBtn {
    top: 5px;
    right: 5px;
    font-size: 14px;
    padding: 4px 12px;
  }

  iframe {
    height: 250px;
  }
}
    </style>
</head>
<body>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <h1>Color-Coded Bible</h1>

<!-- Hidden form container (Floating on left side) -->
<div id="formContainer" style="display: none; position: fixed; left: 10px; top: 10px; width: 400px;">
    <button id="toggleFormBtn" style="float: right; background-color: #f44336; color: white; border: none; padding: 5px 10px; cursor: pointer;">Close</button>
    <iframe id="suggestionForm" src="https://docs.google.com/forms/d/e/1FAIpQLSf0pGZFjskpi5fASZ3aGKk0Ormp2qH1aggCRiu2pq5X9SuCbQ/viewform?embedded=true" frameborder="0" marginheight="0" marginwidth="0" width="100%" height="400px">Loadingâ€¦</iframe>
</div>


    <div class="filter-section">
        <label for="section-select">Select Section: </label>
        <select id="section-select" onchange="filterBySection()">
            <option value="">Select Section</option>
            <option value="Torah">Torah</option>
            <option value="Neviim">Neviim</option>
            <option value="Ketuvim">Ketuvim</option>
        </select>
    
        <label for="book-select">Select Book: </label>
        <select id="book-select" onchange="filterByBook()">
            <option value="">Select a Book</option>
        </select>

        <label for="chapter-select" id="chapter-label" style="display:none;">Select Chapter: </label>
        <select id="chapter-select" onchange="filterByChapter()" style="display:none;">
        <option value="">Select a Chapter</option>
        </select>
    
        <label for="parsha-select" id="parsha-label" style="display:none;">Select Parsha: </label>
        <select id="parsha-select" onchange="filterByParsha()" style="display:none;">
            <option value="">Select a Parsha</option>
        </select>
    
        <label for="aliya-select" id="aliya-label" style="display:none;">Select Aliya: </label>
        <select id="aliya-select" onchange="filterByAliya()" style="display:none;">
            <option value="">Select an Aliya</option>
        </select>
    </div>

    <div class="filter-buttons">
        <button class="device-waw-explicativum" onclick="filterByDevice('waw-explicativum')">
            Waw Explicativum (<span id="count-waw-explicativum">0</span>)
        </button>
        <button class="device-hendiadys" onclick="filterByDevice('hendiadys')">
            Hendiadys (<span id="count-hendiadys">0</span>)
        </button>
        <button class="device-synecdoche" onclick="filterByDevice('synecdoche')">
            Synecdoche (<span id="count-synecdoche">0</span>)
        </button>
        <button class="device-hapax" onclick="filterByDevice('hapax')">
          Hapax (<span id="count-hapax">0</span>)
      </button>
        <button class="device-merism" onclick="filterByDevice('merism')">
            Merism (<span id="count-merism">0</span>)
        </button>
        <button class="device-wordplay" onclick="filterByDevice('wordplay')">
            Wordplay (<span id="count-wordplay">0</span>)
        </button>
        <button class="device-euphemism" onclick="filterByDevice('euphemism')">
            Euphemism (<span id="count-euphemism">0</span>)
        </button>
        <button class="device-simile" onclick="filterByDevice('simile')">
            Simile (<span id="count-simile">0</span>)
        </button>
        <button class="device-ambiguity" onclick="filterByDevice('ambiguity')">
            Ambiguity (<span id="count-ambiguity">0</span>)
        </button>
    </div>

    <!-- Button to toggle chart visibility -->
<button id="toggleChartBtn">Show Chart</button>

<!-- Container for the chart, hidden by default -->
<div id="chartContainer" style="display: none; margin-top: 20px;">
    <canvas id="deviceChart" width="400" height="200"></canvas>
</div>

    <div class="verses">
        <p>Please select a book or device to view verses.</p>
    </div>

    <footer>
        Powered by JavaScript & Google Sheets API | Designed for easier exploration of literary devices in the Bible
    </footer>

    <script>
        // Disable console logging
    console.log = function() {};   // Disable logs
    console.warn = function() {};  // Disable warnings
    console.error = function() {}; // Disable errors (use cautiously)
        const API_KEY = 'AIzaSyAJH1Uoae-nnNRq2DmMUsdOUwhhsW2E8yU';
        const SHEET_ID = '1AQigxLa6S8HAoVeUYohh4AjQ_9YU_HgXBjuXZdl6msg';
        const RANGE = 'tanakh_verses_hebrew!A:H';

        let versesData = [];

        const deviceColors = {
            'waw-explicativum': 'device-waw-explicativum',
            'hendiadys': 'device-hendiadys',
            'synecdoche': 'device-synecdoche',
            'merism': 'device-merism',
            'wordplay': 'device-wordplay',
            'euphemism': 'device-euphemism',
            'simile': 'device-simile',
            'ambiguity': 'device-ambiguity',
            'hapax': 'device-hapax',
            // Add more devices and their corresponding classes
        };

        const bookToParsha = {
    "Genesis": ["Bereshit", "Noach", "Lech-Lecha", "Vayera", "Chayei Sarah", "Toldot", "Vayetze", "Vayishlach", "Vayeshev", "Miketz", "Vayigash", "Vayechi"],
    "Exodus": ["Shemot", "Va'era", "Bo", "Beshalach", "Yitro", "Mishpatim", "Terumah", "Tetzaveh", "Ki Tisa", "Vayakhel", "Pekudei"],
    "Leviticus": ["Vayikra", "Tzav", "Shmini", "Tazria", "Metzora", "Acharei Mot", "Kedoshim", "Emor", "Behar", "Bechukotai"],
    "Numbers": ["Bamidbar", "Nasso", "Beha'alotecha", "Sh'lach", "Korach", "Chukat", "Balak", "Pinchas", "Matot", "Masei"],
    "Deuteronomy": ["Devarim", "Va'etchanan", "Eikev", "Re'eh", "Shoftim", "Ki Teitzei", "Ki Tavo", "Nitzavim", "Vayelech", "Ha'azinu", "V'Zot HaBerachah"]
};
        const tanachBooks = {
    "Torah": [
        { value: "Genesis", display: "Genesis" },
        { value: "Exodus", display: "Exodus" },
        { value: "Leviticus", display: "Leviticus" },
        { value: "Numbers", display: "Numbers" },
        { value: "Deuteronomy", display: "Deuteronomy" }
    ],
    "Neviim": [
        { value: "Joshua", display: "Joshua" },
        { value: "Judges", display: "Judges" },
        { value: "1Samuel", display: "1 Samuel" },
        { value: "2Samuel", display: "2 Samuel" },
        { value: "1Kings", display: "1 Kings" },
        { value: "2Kings", display: "2 Kings" },
        { value: "Isaiah", display: "Isaiah" },
        { value: "Jeremiah", display: "Jeremiah" },
        { value: "Ezekiel", display: "Ezekiel" },
        { value: "Hosea", display: "Hosea" },
        { value: "Joel", display: "Joel" },
        { value: "Amos", display: "Amos" },
        { value: "Obadiah", display: "Obadiah" },
        { value: "Jonah", display: "Jonah" },
        { value: "Micah", display: "Micah" },
        { value: "Nahum", display: "Nahum" },
        { value: "Habakkuk", display: "Habakkuk" },
        { value: "Zephaniah", display: "Zephaniah" },
        { value: "Haggai", display: "Haggai" },
        { value: "Zechariah", display: "Zechariah" },
        { value: "Malachi", display: "Malachi" }
    ],
    "Ketuvim": [
        { value: "Psalms", display: "Psalms" },
        { value: "Proverbs", display: "Proverbs" },
        { value: "Job", display: "Job" },
        { value: "SongofSongs", display: "Song of Songs" },
        { value: "Ruth", display: "Ruth" },
        { value: "Lamentations", display: "Lamentations" },
        { value: "Ecclesiastes", display: "Ecclesiastes" },
        { value: "Esther", display: "Esther" },
        { value: "Daniel", display: "Daniel" },
        { value: "Ezra", display: "Ezra" },
        { value: "Nehemiah", display: "Nehemiah" },
        { value: "1Chronicles", display: "1 Chronicles" },
        { value: "2Chronicles", display: "2 Chronicles" }
    ]
};

        // Load the Google Sheets data
        // Load the Google Sheets data and count the devices
// Load the Google Sheets data
function loadVerses(callback) {
    if (versesData.length === 0) {
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${RANGE}?key=${API_KEY}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                versesData = data.values || [];
                console.log(versesData.slice(0, 5)); // Log the first 5 rows of raw data
                updateDeviceCounts();  // Call update device counts after loading the data
                callback();
            })
            .catch(error => console.error('Error loading Google Sheets data:', error));
    } else {
        updateDeviceCounts(); // If data is already loaded, update counts immediately
        callback();
    }
}

// Function to update the counts of each literary device from Column E
function updateDeviceCounts() {
    // List of all devices
    const devices = [
        'waw-explicativum',
        'hendiadys',
        'synecdoche',
        'merism',
        'wordplay',
        'euphemism',
        'simile',
        'ambiguity',
        'hapax'
    ];

    // Initialize counts for each device
    const deviceCounts = {
        'waw-explicativum': 0,
        'hendiadys': 0,
        'synecdoche': 0,
        'merism': 0,
        'wordplay': 0,
        'euphemism': 0,
        'simile': 0,
        'ambiguity': 0,
        'hapax': 0
    };

    // Loop through the loaded verses data to count occurrences in Column E (index 4)
    versesData.forEach(row => {
        const device = row[4]?.toLowerCase(); // Column E contains the device (make lowercase to match)
        if (device && deviceCounts.hasOwnProperty(device)) {
            deviceCounts[device]++;
        }
    });

    // Update the counts in the buttons
    devices.forEach(device => {
        const countElement = document.getElementById(`count-${device}`);
        if (countElement) {
            countElement.innerText = deviceCounts[device]; // Update the count for the corresponding device
        }
    });
}

// Call the function to load data and count devices on page load
loadVerses(() => {
    displayVerses(() => true); // Show all devices on page load
});

        // Display the verses with device highlights and filters
        // Display the verses with device highlights and correct numbering
// Display the verses with device highlights and correct numbering
// Display the verses with device highlights and correct numbering
function getDisplayName(bookValue) {
    for (let section in tanachBooks) {
        const books = tanachBooks[section];
        for (let book of books) {
            if (book.value.toLowerCase() === bookValue.toLowerCase()) {
                return book.display; // Return the display name with spaces
            }
        }
    }
    return bookValue; // Default to original value if not found
}

function displayVerses(filterFn, bookName, additionalFilter = null) {
  const versesContainer = document.querySelector('.verses');
  versesContainer.innerHTML = ''; // Clear previous verses

  let hasVerses = false;
  const verseMap = {};
  const deviceCounts = {
    'waw-explicativum': 0,
    'hendiadys': 0,
    'synecdoche': 0,
    'merism': 0,
    'wordplay': 0,
    'euphemism': 0,
    'simile': 0,
    'ambiguity': 0,
    'hapax': 0
  };

  // Start loop from 1 to skip the header (versesData[0])
  for (let i = 1; i < versesData.length; i++) {
    const row = versesData[i];

    // Handle potential missing data in rows
    if (row.length < 4) {
      console.warn(`Skipping row ${i} because it's missing necessary fields:`, row);
      continue;
    }

    // Use destructuring with default values for optional fields
    const [book, chapter, verse, text, device = '', words = '', sources = '', urls = ''] = row;

    if (!book || !chapter || !verse || !text) {
      continue;
    }

    // Apply the additional filter if provided
    if (additionalFilter && !additionalFilter(book, chapter, verse)) continue;

    const verseKey = `${book} ${chapter}:${verse}`;
    if (!verseMap[verseKey]) {
      verseMap[verseKey] = {
        text: text,
        devices: [],
        sources: [],
        urls: []
      };
    }

    verseMap[verseKey].devices.push({ device, words });

    // Split sources and URLs by semicolons, handle empty cases
    const sourceArray = sources ? sources.split(';').map(src => src.trim()) : [];
    const urlArray = urls ? urls.split(';').map(url => url.trim()) : [];

    verseMap[verseKey].sources.push(sourceArray);
    verseMap[verseKey].urls.push(urlArray);
  }

  Object.keys(verseMap).forEach(verseKey => {
    const verseData = verseMap[verseKey];
    const [book, chapterVerse] = verseKey.split(' ', 2);
    const displayBookName = getDisplayName(book);

    if (filterFn(book, verseData.devices)) {
      hasVerses = true;

      verseData.devices.forEach(d => {
        if (d.device && deviceCounts.hasOwnProperty(d.device.toLowerCase())) {
          deviceCounts[d.device.toLowerCase()]++;
        }
      });

      const verseDiv = document.createElement("div");
      verseDiv.className = "verse";
      verseDiv.setAttribute("data-verse", verseKey);

      let highlightedText = verseData.text;
      let sourceCounter = verseData.devices.length;
      let sourceMapping = [];

      verseData.devices.forEach((d, index) => {
        if (d.words) {
          const regex = new RegExp(d.words, 'g');
          highlightedText = highlightedText.replace(
            regex,
            `<span class="highlight ${deviceColors[d.device.toLowerCase()]}">${d.words}<sup class="superscript">${sourceCounter}</sup></span>`
          );

          let sourcesForDevice = verseData.sources[index]
            .map((source, srcIndex) =>
              `<a href="${verseData.urls[index][srcIndex]}" class="source" target="_blank">${source}</a>`
            )
            .join(', ');

          sourceMapping.push(
            `<span class="${deviceColors[d.device.toLowerCase()]}">${sourceCounter}. (${d.device}) ${sourcesForDevice}</span>`
          );
          sourceCounter--;
        }
      });

      sourceMapping.reverse();
      let sourcesDisplay = `<div class="source-block">${sourceMapping.join('<br>')}</div>`;

      verseDiv.innerHTML = `<span>${displayBookName} ${chapterVerse}</span> <span>${highlightedText}</span><br/>${sourcesDisplay}`;

      const plusBtn = document.createElement("button");
      plusBtn.className = "verse-plus-btn";
      plusBtn.innerHTML = "+";
      plusBtn.addEventListener('click', function (event) {
        event.stopPropagation();
        toggleFormVisibility(verseKey);
      });

      verseDiv.appendChild(plusBtn);
      versesContainer.appendChild(verseDiv);

      verseDiv.addEventListener('click', function () {
        const verseText = verseKey;
        prefillGoogleForm(verseText);
      });
    }
  });

  if (!hasVerses) {
    versesContainer.innerHTML = '<p>No verses found for the selected filter.</p>';
  }

  updateChart(deviceCounts, bookName);
}



// Function to prefill the Google Form
function prefillGoogleForm(verseText) {
    const formURL = `https://docs.google.com/forms/d/e/1FAIpQLSf0pGZFjskpi5fASZ3aGKk0Ormp2qH1aggCRiu2pq5X9SuCbQ/viewform?usp=pp_url&entry.1645440068=${encodeURIComponent(verseText)}`;
    
    // Update the iframe with the pre-filled form URL
    document.getElementById('suggestionForm').src = formURL;

    // Optionally make the form visible
    document.getElementById('formContainer').style.display = 'block';
}



// Attach prefill functionality to the verses
function attachPrefillListeners() {
    const verses = document.querySelectorAll('.verse');
    verses.forEach(verse => {
        verse.addEventListener('click', function() {
            const verseText = verse.getAttribute('data-verse'); // Get the verse reference
            prefillGoogleForm(verseText); // Prefill the form with the selected verse
        });
    });
}

        // Filter by Literary Device
        function filterByDevice(device) {
            loadVerses(() => {
                displayVerses((book, devices) => {
                    return devices.some(d => {
                        if (d.device) {
                            return !device || d.device.toLowerCase() === device.toLowerCase();
                        }
                        return false;
                    });
                });
            });
        }

        // Filter by Book
        function filterByBook(book) {
            loadVerses(() => {
                displayVerses((currentBook) => currentBook === book);
            });
        }

        // Initial display showing all devices by default
        loadVerses(() => {
            displayVerses(() => true); // Show all devices on page load
        });



const parshas = {
"Bereshit": {
"Whole Parsha": "Genesis 1:1-6:8",
"Aliya 1": "Genesis 1:1-2:3",
"Aliya 2": "Genesis 2:4-2:19",
"Aliya 3": "Genesis 2:20-3:21",
"Aliya 4": "Genesis 3:22-4:18",
"Aliya 5": "Genesis 4:19-4:22",
"Aliya 6": "Genesis 4:23-5:24",
"Aliya 7": "Genesis 5:25-6:8"
},
"Noach": {
"Whole Parsha": "Genesis 6:9-11:32",
"Aliya 1": "Genesis 6:9-6:22",
"Aliya 2": "Genesis 7:1-7:16",
"Aliya 3": "Genesis 7:17-8:14",
"Aliya 4": "Genesis 8:15-9:7",
"Aliya 5": "Genesis 9:8-9:17",
"Aliya 6": "Genesis 9:18-10:32",
"Aliya 7": "Genesis 11:1-11:32"
},
"Lech-Lecha": {
"Whole Parsha": "Genesis 12:1-17:27",
"Aliya 1": "Genesis 12:1-12:13",
"Aliya 2": "Genesis 12:14-13:4",
"Aliya 3": "Genesis 13:5-13:18",
"Aliya 4": "Genesis 14:1-14:20",
"Aliya 5": "Genesis 14:21-15:6",
"Aliya 6": "Genesis 15:7-17:6",
"Aliya 7": "Genesis 17:7-17:27"
},
"Vayera": {
"Whole Parsha": "Genesis 18:1-22:24",
"Aliya 1": "Genesis 18:1-18:14",
"Aliya 2": "Genesis 18:15-18:33",
"Aliya 3": "Genesis 19:1-19:20",
"Aliya 4": "Genesis 19:21-21:4",
"Aliya 5": "Genesis 21:5-21:21",
"Aliya 6": "Genesis 21:22-21:34",
"Aliya 7": "Genesis 22:1-22:24"
},
"Chayei Sarah": {
"Whole Parsha": "Genesis 23:1-25:18",
"Aliya 1": "Genesis 23:1-23:16",
"Aliya 2": "Genesis 23:17-24:9",
"Aliya 3": "Genesis 24:10-24:26",
"Aliya 4": "Genesis 24:27-24:52",
"Aliya 5": "Genesis 24:53-24:67",
"Aliya 6": "Genesis 25:1-25:11",
"Aliya 7": "Genesis 25:12-25:18"
},
"Toldot": {
"Whole Parsha": "Genesis 25:19-28:9",
"Aliya 1": "Genesis 25:19-26:5",
"Aliya 2": "Genesis 26:6-26:12",
"Aliya 3": "Genesis 26:13-26:22",
"Aliya 4": "Genesis 26:23-26:29",
"Aliya 5": "Genesis 26:30-27:27",
"Aliya 6": "Genesis 27:28-28:4",
"Aliya 7": "Genesis 28:5-28:9"
},
"Vayetze": {
"Whole Parsha": "Genesis 28:10-32:3",
"Aliya 1": "Genesis 28:10-28:22",
"Aliya 2": "Genesis 29:1-29:17",
"Aliya 3": "Genesis 29:18-30:13",
"Aliya 4": "Genesis 30:14-30:27",
"Aliya 5": "Genesis 30:28-31:16",
"Aliya 6": "Genesis 31:17-31:42",
"Aliya 7": "Genesis 31:43-32:3"
},
"Vayishlach": {
"Whole Parsha": "Genesis 32:4-36:43",
"Aliya 1": "Genesis 32:4-32:13",
"Aliya 2": "Genesis 32:14-32:30",
"Aliya 3": "Genesis 32:31-33:5",
"Aliya 4": "Genesis 33:6-33:20",
"Aliya 5": "Genesis 34:1-35:11",
"Aliya 6": "Genesis 35:12-36:19",
"Aliya 7": "Genesis 36:20-36:43"
},
"Vayeshev": {
"Whole Parsha": "Genesis 37:1-40:23",
"Aliya 1": "Genesis 37:1-37:11",
"Aliya 2": "Genesis 37:12-37:22",
"Aliya 3": "Genesis 37:23-37:36",
"Aliya 4": "Genesis 38:1-38:30",
"Aliya 5": "Genesis 39:1-39:6",
"Aliya 6": "Genesis 39:7-39:23",
"Aliya 7": "Genesis 40:1-40:23"
},
"Miketz": {
"Whole Parsha": "Genesis 41:1-44:17",
"Aliya 1": "Genesis 41:1-41:14",
"Aliya 2": "Genesis 41:15-41:38",
"Aliya 3": "Genesis 41:39-41:52",
"Aliya 4": "Genesis 41:53-42:18",
"Aliya 5": "Genesis 42:19-43:15",
"Aliya 6": "Genesis 43:16-43:29",
"Aliya 7": "Genesis 43:30-44:17"
},
"Vayigash": {
"Whole Parsha": "Genesis 44:18-47:27",
"Aliya 1": "Genesis 44:18-44:30",
"Aliya 2": "Genesis 44:31-45:7",
"Aliya 3": "Genesis 45:8-45:18",
"Aliya 4": "Genesis 45:19-45:27",
"Aliya 5": "Genesis 45:28-46:27",
"Aliya 6": "Genesis 46:28-47:10",
"Aliya 7": "Genesis 47:11-47:27"
},
"Vayechi": {
"Whole Parsha": "Genesis 47:28-50:26",
"Aliya 1": "Genesis 47:28-48:9",
"Aliya 2": "Genesis 48:10-48:16",
"Aliya 3": "Genesis 48:17-48:22",
"Aliya 4": "Genesis 49:1-49:18",
"Aliya 5": "Genesis 49:19-49:26",
"Aliya 6": "Genesis 49:27-50:20",
"Aliya 7": "Genesis 50:21-50:26"
},
"Shemot": {
"Whole Parsha": "Exodus 1:1-6:1",
"Aliya 1": "Exodus 1:1-1:17",
"Aliya 2": "Exodus 1:18-2:10",
"Aliya 3": "Exodus 2:11-2:25",
"Aliya 4": "Exodus 3:1-3:15",
"Aliya 5": "Exodus 3:16-4:17",
"Aliya 6": "Exodus 4:18-4:31",
"Aliya 7": "Exodus 5:1-6:1"
},
"Va'era": {
"Whole Parsha": "Exodus 6:2-9:35",
"Aliya 1": "Exodus 6:2-6:13",
"Aliya 2": "Exodus 6:14-6:28",
"Aliya 3": "Exodus 6:29-7:7",
"Aliya 4": "Exodus 7:8-8:6",
"Aliya 5": "Exodus 8:7-8:18",
"Aliya 6": "Exodus 8:19-9:16",
"Aliya 7": "Exodus 9:17-9:35"
},
"Bo": {
"Whole Parsha": "Exodus 10:1-13:16",
"Aliya 1": "Exodus 10:1-10:11",
"Aliya 2": "Exodus 10:12-10:23",
"Aliya 3": "Exodus 10:24-11:3",
"Aliya 4": "Exodus 11:4-12:20",
"Aliya 5": "Exodus 12:21-12:28",
"Aliya 6": "Exodus 12:29-12:51",
"Aliya 7": "Exodus 13:1-13:16"
},
"Beshalach": {
"Whole Parsha": "Exodus 13:17-17:16",
"Aliya 1": "Exodus 13:17-14:8",
"Aliya 2": "Exodus 14:9-14:14",
"Aliya 3": "Exodus 14:15-14:25",
"Aliya 4": "Exodus 14:26-15:26",
"Aliya 5": "Exodus 15:27-16:10",
"Aliya 6": "Exodus 16:11-16:36",
"Aliya 7": "Exodus 17:1-17:16"
},
"Yitro": {
"Whole Parsha": "Exodus 18:1-20:23",
"Aliya 1": "Exodus 18:1-18:12",
"Aliya 2": "Exodus 18:13-18:23",
"Aliya 3": "Exodus 18:24-18:27",
"Aliya 4": "Exodus 19:1-19:6",
"Aliya 5": "Exodus 19:7-19:19",
"Aliya 6": "Exodus 19:20-20:14",
"Aliya 7": "Exodus 20:15-20:23"
},
"Mishpatim": {
"Whole Parsha": "Exodus 21:1-24:18",
"Aliya 1": "Exodus 21:1-21:19",
"Aliya 2": "Exodus 21:20-22:3",
"Aliya 3": "Exodus 22:4-22:26",
"Aliya 4": "Exodus 22:27-23:5",
"Aliya 5": "Exodus 23:6-23:19",
"Aliya 6": "Exodus 23:20-23:25",
"Aliya 7": "Exodus 23:26-24:18"
},
"Terumah": {
"Whole Parsha": "Exodus 25:1-27:19",
"Aliya 1": "Exodus 25:1-25:16",
"Aliya 2": "Exodus 25:17-25:30",
"Aliya 3": "Exodus 25:31-26:14",
"Aliya 4": "Exodus 26:15-26:30",
"Aliya 5": "Exodus 26:31-26:37",
"Aliya 6": "Exodus 27:1-27:8",
"Aliya 7": "Exodus 27:9-27:19"
},
"Tetzaveh": {
"Whole Parsha": "Exodus 27:20-30:10",
"Aliya 1": "Exodus 27:20-28:12",
"Aliya 2": "Exodus 28:13-28:30",
"Aliya 3": "Exodus 28:31-28:43",
"Aliya 4": "Exodus 29:1-29:18",
"Aliya 5": "Exodus 29:19-29:37",
"Aliya 6": "Exodus 29:38-29:46",
"Aliya 7": "Exodus 30:1-30:10"
},
"Ki Tisa": {
"Whole Parsha": "Exodus 30:11-34:35",
"Aliya 1": "Exodus 30:11-31:17",
"Aliya 2": "Exodus 31:18-33:11",
"Aliya 3": "Exodus 33:12-33:16",
"Aliya 4": "Exodus 33:17-33:23",
"Aliya 5": "Exodus 34:1-34:9",
"Aliya 6": "Exodus 34:10-34:26",
"Aliya 7": "Exodus 34:27-34:35"
},
"Vayakhel": {
"Whole Parsha": "Exodus 35:1-38:20",
"Aliya 1": "Exodus 35:1-35:20",
"Aliya 2": "Exodus 35:21-35:29",
"Aliya 3": "Exodus 35:30-36:7",
"Aliya 4": "Exodus 36:8-36:19",
"Aliya 5": "Exodus 36:20-37:16",
"Aliya 6": "Exodus 37:17-37:29",
"Aliya 7": "Exodus 38:1-38:20"
},
"Pekudei": {
"Whole Parsha": "Exodus 38:21-40:38",
"Aliya 1": "Exodus 38:21-39:1",
"Aliya 2": "Exodus 39:2-39:21",
"Aliya 3": "Exodus 39:22-39:32",
"Aliya 4": "Exodus 39:33-39:43",
"Aliya 5": "Exodus 40:1-40:16",
"Aliya 6": "Exodus 40:17-40:27",
"Aliya 7": "Exodus 40:28-40:38"
},
"Vayikra": {
"Whole Parsha": "Leviticus 1:1-5:26",
"Aliya 1": "Leviticus 1:1-1:13",
"Aliya 2": "Leviticus 1:14-2:6",
"Aliya 3": "Leviticus 2:7-2:16",
"Aliya 4": "Leviticus 3:1-3:17",
"Aliya 5": "Leviticus 4:1-4:26",
"Aliya 6": "Leviticus 4:27-5:10",
"Aliya 7": "Leviticus 5:11-5:26"
},
"Tzav": {
"Whole Parsha": "Leviticus 6:1-8:36",
"Aliya 1": "Leviticus 6:1-6:11",
"Aliya 2": "Leviticus 6:12-7:10",
"Aliya 3": "Leviticus 7:11-7:38",
"Aliya 4": "Leviticus 8:1-8:13",
"Aliya 5": "Leviticus 8:14-8:21",
"Aliya 6": "Leviticus 8:22-8:29",
"Aliya 7": "Leviticus 8:30-8:36"
},
"Shmini": {
"Whole Parsha": "Leviticus 9:1-11:47",
"Aliya 1": "Leviticus 9:1-9:16",
"Aliya 2": "Leviticus 9:17-9:23",
"Aliya 3": "Leviticus 9:24-10:11",
"Aliya 4": "Leviticus 10:12-10:15",
"Aliya 5": "Leviticus 10:16-10:20",
"Aliya 6": "Leviticus 11:1-11:32",
"Aliya 7": "Leviticus 11:33-11:47"
},
"Tazria": {
"Whole Parsha": "Leviticus 12:1-13:59",
"Aliya 1": "Leviticus 12:1-13:5",
"Aliya 2": "Leviticus 13:6-13:17",
"Aliya 3": "Leviticus 13:18-13:23",
"Aliya 4": "Leviticus 13:24-13:28",
"Aliya 5": "Leviticus 13:29-13:39",
"Aliya 6": "Leviticus 13:40-13:54",
"Aliya 7": "Leviticus 13:55-13:59"
},
"Metzora": {
"Whole Parsha": "Leviticus 14:1-15:33",
"Aliya 1": "Leviticus 14:1-14:12",
"Aliya 2": "Leviticus 14:13-14:20",
"Aliya 3": "Leviticus 14:21-14:32",
"Aliya 4": "Leviticus 14:33-14:53",
"Aliya 5": "Leviticus 14:54-15:15",
"Aliya 6": "Leviticus 15:16-15:28",
"Aliya 7": "Leviticus 15:29-15:33"
},
"Acharei Mot": {
"Whole Parsha": "Leviticus 16:1-18:30",
"Aliya 1": "Leviticus 16:1-16:17",
"Aliya 2": "Leviticus 16:18-16:24",
"Aliya 3": "Leviticus 16:25-16:34",
"Aliya 4": "Leviticus 17:1-17:7",
"Aliya 5": "Leviticus 17:8-18:5",
"Aliya 6": "Leviticus 18:6-18:21",
"Aliya 7": "Leviticus 18:22-18:30"
},
"Kedoshim": {
"Whole Parsha": "Leviticus 19:1-20:27",
"Aliya 1": "Leviticus 19:1-19:14",
"Aliya 2": "Leviticus 19:15-19:22",
"Aliya 3": "Leviticus 19:23-19:32",
"Aliya 4": "Leviticus 19:33-19:37",
"Aliya 5": "Leviticus 20:1-20:7",
"Aliya 6": "Leviticus 20:8-20:22",
"Aliya 7": "Leviticus 20:23-20:27"
},
"Emor": {
"Whole Parsha": "Leviticus 21:1-24:23",
"Aliya 1": "Leviticus 21:1-21:15",
"Aliya 2": "Leviticus 21:16-22:16",
"Aliya 3": "Leviticus 22:17-22:33",
"Aliya 4": "Leviticus 23:1-23:22",
"Aliya 5": "Leviticus 23:23-23:32",
"Aliya 6": "Leviticus 23:33-23:44",
"Aliya 7": "Leviticus 24:1-24:23"
},
"Behar": {
"Whole Parsha": "Leviticus 25:1-26:2",
"Aliya 1": "Leviticus 25:1-25:13",
"Aliya 2": "Leviticus 25:14-25:18",
"Aliya 3": "Leviticus 25:19-25:24",
"Aliya 4": "Leviticus 25:25-25:28",
"Aliya 5": "Leviticus 25:29-25:38",
"Aliya 6": "Leviticus 25:39-25:46",
"Aliya 7": "Leviticus 25:47-26:2"
},
"Bechukotai": {
"Whole Parsha": "Leviticus 26:3-27:34",
"Aliya 1": "Leviticus 26:3-26:5",
"Aliya 2": "Leviticus 26:6-26:9",
"Aliya 3": "Leviticus 26:10-26:46",
"Aliya 4": "Leviticus 27:1-27:15",
"Aliya 5": "Leviticus 27:16-27:21",
"Aliya 6": "Leviticus 27:22-27:28",
"Aliya 7": "Leviticus 27:29-27:34"
},
"Bamidbar": {
"Whole Parsha": "Numbers 1:1-4:20",
"Aliya 1": "Numbers 1:1-1:19",
"Aliya 2": "Numbers 1:20-1:54",
"Aliya 3": "Numbers 2:1-2:34",
"Aliya 4": "Numbers 3:1-3:13",
"Aliya 5": "Numbers 3:14-3:39",
"Aliya 6": "Numbers 3:40-3:51",
"Aliya 7": "Numbers 4:1-4:20"
},
"Nasso": {
"Whole Parsha": "Numbers 4:21-7:89",
"Aliya 1": "Numbers 4:21-4:37",
"Aliya 2": "Numbers 4:38-4:49",
"Aliya 3": "Numbers 5:1-5:10",
"Aliya 4": "Numbers 5:11-6:27",
"Aliya 5": "Numbers 7:1-7:41",
"Aliya 6": "Numbers 7:42-7:71",
"Aliya 7": "Numbers 7:72-7:89"
},
"Beha'alotecha": {
"Whole Parsha": "Numbers 8:1-12:16",
"Aliya 1": "Numbers 8:1-8:14",
"Aliya 2": "Numbers 8:15-8:26",
"Aliya 3": "Numbers 9:1-9:14",
"Aliya 4": "Numbers 9:15-10:10",
"Aliya 5": "Numbers 10:11-10:34",
"Aliya 6": "Numbers 10:35-11:29",
"Aliya 7": "Numbers 11:30-12:16"
},
"Sh'lach": {
"Whole Parsha": "Numbers 13:1-15:41",
"Aliya 1": "Numbers 13:1-13:20",
"Aliya 2": "Numbers 13:21-14:7",
"Aliya 3": "Numbers 14:8-14:25",
"Aliya 4": "Numbers 14:26-15:7",
"Aliya 5": "Numbers 15:8-15:16",
"Aliya 6": "Numbers 15:17-15:26",
"Aliya 7": "Numbers 15:27-15:41"
},
"Korach": {
"Whole Parsha": "Numbers 16:1-18:32",
"Aliya 1": "Numbers 16:1-16:13",
"Aliya 2": "Numbers 16:14-16:19",
"Aliya 3": "Numbers 16:20-17:8",
"Aliya 4": "Numbers 17:9-17:15",
"Aliya 5": "Numbers 17:16-17:24",
"Aliya 6": "Numbers 17:25-18:20",
"Aliya 7": "Numbers 18:21-18:32"
},
"Chukat": {
"Whole Parsha": "Numbers 19:1-22:1",
"Aliya 1": "Numbers 19:1-19:17",
"Aliya 2": "Numbers 19:18-20:6",
"Aliya 3": "Numbers 20:7-20:13",
"Aliya 4": "Numbers 20:14-20:21",
"Aliya 5": "Numbers 20:22-21:9",
"Aliya 6": "Numbers 21:10-21:20",
"Aliya 7": "Numbers 21:21-22:1"
},
"Balak": {
"Whole Parsha": "Numbers 22:2-25:9",
"Aliya 1": "Numbers 22:2-22:12",
"Aliya 2": "Numbers 22:13-22:20",
"Aliya 3": "Numbers 22:21-22:38",
"Aliya 4": "Numbers 22:39-23:12",
"Aliya 5": "Numbers 23:13-23:26",
"Aliya 6": "Numbers 23:27-24:13",
"Aliya 7": "Numbers 24:14-25:9"
},
"Pinchas": {
"Whole Parsha": "Numbers 25:10-30:1",
"Aliya 1": "Numbers 25:10-26:4",
"Aliya 2": "Numbers 26:5-26:51",
"Aliya 3": "Numbers 26:52-27:5",
"Aliya 4": "Numbers 27:6-27:23",
"Aliya 5": "Numbers 28:1-28:15",
"Aliya 6": "Numbers 28:16-29:11",
"Aliya 7": "Numbers 29:12-30:1"
},
"Matot": {
"Whole Parsha": "Numbers 30:2-32:42",
"Aliya 1": "Numbers 30:2-31:12",
"Aliya 2": "Numbers 31:13-31:54",
"Aliya 3": "Numbers 32:1-32:19",
"Aliya 4": "Numbers 32:20-33:49",
"Aliya 5": "Numbers 33:50-34:15",
"Aliya 6": "Numbers 34:16-35:8",
"Aliya 7": "Numbers 35:9-36:13"
},
"Masei": {
"Whole Parsha": "Numbers 33:1-36:13",
"Aliya 1": "",
"Aliya 2": "",
"Aliya 3": "",
"Aliya 4": "",
"Aliya 5": "",
"Aliya 6": "",
"Aliya 7": ""
},
"Devarim": {
"Whole Parsha": "Deuteronomy 1:1-3:22",
"Aliya 1": "Deuteronomy 1:1-1:10",
"Aliya 2": "Deuteronomy 1:11-1:21",
"Aliya 3": "Deuteronomy 1:22-1:38",
"Aliya 4": "Deuteronomy 1:39-2:1",
"Aliya 5": "Deuteronomy 2:2-2:30",
"Aliya 6": "Deuteronomy 2:31-3:14",
"Aliya 7": "Deuteronomy 3:15-3:22"
},
"Va'etchanan": {
"Whole Parsha": "Deuteronomy 3:23-7:11",
"Aliya 1": "Deuteronomy 3:23-4:4",
"Aliya 2": "Deuteronomy 4:5-4:40",
"Aliya 3": "Deuteronomy 4:41-4:49",
"Aliya 4": "Deuteronomy 5:1-5:18",
"Aliya 5": "Deuteronomy 5:19-6:3",
"Aliya 6": "Deuteronomy 6:4-6:25",
"Aliya 7": "Deuteronomy 7:1-7:11"
},
"Eikev": {
"Whole Parsha": "Deuteronomy 7:12-11:25",
"Aliya 1": "Deuteronomy 7:12-8:10",
"Aliya 2": "Deuteronomy 8:11-9:3",
"Aliya 3": "Deuteronomy 9:4-9:29",
"Aliya 4": "Deuteronomy 10:1-10:11",
"Aliya 5": "Deuteronomy 10:12-11:9",
"Aliya 6": "Deuteronomy 11:10-11:21",
"Aliya 7": "Deuteronomy 11:22-11:25"
},
"Re'eh": {
"Whole Parsha": "Deuteronomy 11:26-16:17",
"Aliya 1": "Deuteronomy 11:26-12:10",
"Aliya 2": "Deuteronomy 12:11-12:28",
"Aliya 3": "Deuteronomy 12:29-13:19",
"Aliya 4": "Deuteronomy 14:1-14:21",
"Aliya 5": "Deuteronomy 14:22-14:29",
"Aliya 6": "Deuteronomy 15:1-15:18",
"Aliya 7": "Deuteronomy 15:19-16:17"
},
"Shoftim": {
"Whole Parsha": "Deuteronomy 16:18-21:9",
"Aliya 1": "Deuteronomy 16:18-17:13",
"Aliya 2": "Deuteronomy 17:14-17:20",
"Aliya 3": "Deuteronomy 18:1-18:5",
"Aliya 4": "Deuteronomy 18:6-18:13",
"Aliya 5": "Deuteronomy 18:14-19:13",
"Aliya 6": "Deuteronomy 19:14-20:9",
"Aliya 7": "Deuteronomy 20:10-21:9"
},
"Ki Teitzei": {
"Whole Parsha": "Deuteronomy 21:10-25:19",
"Aliya 1": "Deuteronomy 21:10-21:21",
"Aliya 2": "Deuteronomy 21:22-22:7",
"Aliya 3": "Deuteronomy 22:8-23:7",
"Aliya 4": "Deuteronomy 23:8-23:24",
"Aliya 5": "Deuteronomy 23:25-24:4",
"Aliya 6": "Deuteronomy 24:5-24:13",
"Aliya 7": "Deuteronomy 24:14-25:19"
},
"Ki Tavo": {
"Whole Parsha": "Deuteronomy 26:1-29:8",
"Aliya 1": "Deuteronomy 26:1-26:11",
"Aliya 2": "Deuteronomy 26:12-26:15",
"Aliya 3": "Deuteronomy 26:16-26:19",
"Aliya 4": "Deuteronomy 27:1-27:10",
"Aliya 5": "Deuteronomy 27:11-28:6",
"Aliya 6": "Deuteronomy 28:7-28:69",
"Aliya 7": "Deuteronomy 29:1-29:8"
},
"Nitzavim": {
"Whole Parsha": "Deuteronomy 29:9-30:20",
"Aliya 1": "Deuteronomy 29:9-29:28",
"Aliya 2": "Deuteronomy 30:1-30:6",
"Aliya 3": "Deuteronomy 30:7-30:14",
"Aliya 4": "Deuteronomy 30:15-31:6",
"Aliya 5": "Deuteronomy 31:7-31:13",
"Aliya 6": "Deuteronomy 31:14-31:19",
"Aliya 7": "Deuteronomy 31:20-31:30"
},
"Vayelech": {
"Whole Parsha": "Deuteronomy 31:1-31:30",
"Aliya 1": "",
"Aliya 2": "",
"Aliya 3": "",
"Aliya 4": "",
"Aliya 5": "",
"Aliya 6": "",
"Aliya 7": ""
},
"Ha'azinu": {
"Whole Parsha": "Deuteronomy 32:1-32:52",
"Aliya 1": "Deuteronomy 32:1-32:6",
"Aliya 2": "Deuteronomy 32:7-32:12",
"Aliya 3": "Deuteronomy 32:13-32:18",
"Aliya 4": "Deuteronomy 32:19-32:28",
"Aliya 5": "Deuteronomy 32:29-32:39",
"Aliya 6": "Deuteronomy 32:40-32:43",
"Aliya 7": "Deuteronomy 32:44-32:52"
},
"V'Zot HaBerachah": {
"Whole Parsha": "Deuteronomy 33:1-34:12",
"Aliya 1": "Deuteronomy 33:1-33:7",
"Aliya 2": "Deuteronomy 33:8-33:12",
"Aliya 3": "Deuteronomy 33:13-33:17",
"Aliya 4": "Deuteronomy 33:18-33:21",
"Aliya 5": "Deuteronomy 33:22-33:26",
"Aliya 6": "Deuteronomy 33:27-34:12",
"Aliya 7": "Genesis 1:1-2:3"
},
};


// Handle section selection
function filterBySection() {
    const sectionSelect = document.getElementById('section-select').value;
    const bookSelect = document.getElementById('book-select');
    const parshaSelect = document.getElementById('parsha-select');
    const aliyaSelect = document.getElementById('aliya-select');

    // Clear previous selections
    bookSelect.innerHTML = '<option value="">Select a Book</option>';
    parshaSelect.innerHTML = '<option value="">Select a Parsha</option>';
    aliyaSelect.innerHTML = '<option value="">Select an Aliya</option>';

    // Hide Parsha and Aliya filters initially
    parshaSelect.style.display = 'none';
    aliyaSelect.style.display = 'none';
    document.getElementById('parsha-label').style.display = 'none';
    document.getElementById('aliya-label').style.display = 'none';

    // Populate the book dropdown based on the selected section
    if (tanachBooks[sectionSelect]) {
        tanachBooks[sectionSelect].forEach(book => {
            const option = document.createElement('option');
            option.value = book.value;  
            option.textContent = book.display;  
            bookSelect.appendChild(option);
        });
    }

    // Display all verses from the selected section (Torah, Neviim, or Ketuvim)
    loadVerses(() => {
        displayVerses((book) => tanachBooks[sectionSelect].some(b => b.value === book));
    });
}

// Handle book selection
// Handle book selection
// Handle book selection
function filterByBook() {
  const sectionSelect = document.getElementById('section-select').value;
  const selectedBook = document.getElementById('book-select').value.trim();
  const parshaSelect = document.getElementById('parsha-select');
  const aliyaSelect = document.getElementById('aliya-select');
  const chapterSelect = document.getElementById('chapter-select');

  // Reset Parsha, Aliya, and Chapter dropdowns
  parshaSelect.innerHTML = '<option value="">Select a Parsha</option>';
  aliyaSelect.innerHTML = '<option value="">Select an Aliya</option>';
  chapterSelect.innerHTML = '<option value="">Select a Chapter</option>';

  // Populate Chapter dropdown for all books using getChaptersForBook
  const chapters = getChaptersForBook(selectedBook);
  chapters.forEach(chapter => {
    const option = document.createElement('option');
    option.value = `Chapter ${chapter}`;
    option.textContent = `Chapter ${chapter}`;
    chapterSelect.appendChild(option);
  });

  // Show Chapter dropdown and label
  chapterSelect.style.display = 'block';
  document.getElementById('chapter-label').style.display = 'block';

  if (sectionSelect === 'Torah' && bookToParsha[selectedBook]) {
    // Populate Parsha dropdown for Torah books
    bookToParsha[selectedBook].forEach(parsha => {
      const option = document.createElement('option');
      option.value = parsha;
      option.textContent = parsha;
      parshaSelect.appendChild(option);
    });

    // Show Parsha dropdown and label
    parshaSelect.style.display = 'block';
    document.getElementById('parsha-label').style.display = 'block';

    // Initially hide Aliya dropdown and label
    aliyaSelect.style.display = 'none';
    document.getElementById('aliya-label').style.display = 'none';
  } else {
    // Hide Parsha and Aliya dropdowns and labels for Neviim and Ketuvim
    parshaSelect.style.display = 'none';
    aliyaSelect.style.display = 'none';
    document.getElementById('parsha-label').style.display = 'none';
    document.getElementById('aliya-label').style.display = 'none';
  }

  // Display the whole book by default
  loadVerses(() => {
    displayVerses((book) => book === selectedBook);
  });
}

function getChaptersForBook(bookName) {
    const chapters = [];

    // Loop through the verses data to find unique chapters for the selected book
    versesData.forEach(row => {
        const [book, chapter] = row;
        if (book === bookName && !chapters.includes(chapter)) {
            chapters.push(chapter); // Add unique chapters
        }
    });

    return chapters.sort((a, b) => a - b); // Sort chapters numerically
}

function filterByChapter() {
  const selectedBook = document.getElementById('book-select').value.trim();
  const selectedChapterText = document.getElementById('chapter-select').value.trim();

  if (!selectedBook) {
    console.error("No book selected!");
    return;
  }

  if (!selectedChapterText) {
    console.error("No chapter selected!");
    return;
  }

  // Extract numeric chapter from the selected text
  const selectedChapter = parseInt(selectedChapterText.replace('Chapter ', '').trim(), 10);

  console.log(`Filtering by book: ${selectedBook}, chapter: ${selectedChapter}`);

  loadVerses(() => {
    // Pass the selectedChapter to displayVerses as an additional filter
    displayVerses(
      (book, devices) => book === selectedBook, // Filter by book
      null, 
      (book, chapter) => parseInt(chapter) === selectedChapter // Filter by chapter
    );
  });
}

// Handle Parsha selection
function filterByParsha() {
    const selectedParsha = document.getElementById('parsha-select').value;
    const aliyaSelect = document.getElementById('aliya-select');

    // Reset Aliya dropdown
    aliyaSelect.innerHTML = '<option value="">Select an Aliya</option>';

    if (parshas[selectedParsha]) {
        let aliyot = parshas[selectedParsha];
        for (let aliya in aliyot) {
            const option = document.createElement('option');
            option.value = aliya;
            option.textContent = aliya;
            aliyaSelect.appendChild(option);
        }

        // Show Aliya dropdown
        aliyaSelect.style.display = 'block';
        document.getElementById('aliya-label').style.display = 'block';

        // Display the whole Parsha when selected
        displayVersesForRange(parshas[selectedParsha]["Whole Parsha"]);
    }
}

// Handle Aliya selection
function filterByAliya() {
    const selectedParsha = document.getElementById('parsha-select').value;
    const selectedAliya = document.getElementById('aliya-select').value;

    if (parshas[selectedParsha] && parshas[selectedParsha][selectedAliya]) {
        const aliyahRange = parshas[selectedParsha][selectedAliya];
        displayVersesForRange(aliyahRange);
    }
}

// Helper function to display verses for a given range
function displayVersesForRange(range) {
    const versesContainer = document.querySelector('.verses');
    const [startRange, endRange] = range.split('-');
    const [startBook, startChapterVerse] = startRange.split(' ');
    const [startChapter, startVerse] = startChapterVerse.split(':');
    const [endChapter, endVerse] = endRange.split(':');

    // Filter and display verses within the selected range
    const filteredVerses = versesData.filter(row => {
        const [book, chapter, verse] = row;

        if (book !== startBook) return false;

        const chapterNum = parseInt(chapter, 10);
        const verseNum = parseInt(verse, 10);

        const withinRange = (
            (chapterNum > parseInt(startChapter) || (chapterNum === parseInt(startChapter) && verseNum >= parseInt(startVerse))) &&
            (chapterNum < parseInt(endChapter) || (chapterNum === parseInt(endChapter) && verseNum <= parseInt(endVerse)))
        );

        return withinRange;
    });

    if (filteredVerses.length > 0) {
        versesContainer.innerHTML = ''; 
        filteredVerses.forEach(row => {
            const [book, chapter, verse, text] = row;
            const verseDiv = document.createElement('div');
            verseDiv.className = 'verse';
            verseDiv.innerHTML = `<strong>${book} ${chapter}:${verse}</strong> - ${text}`;
            versesContainer.appendChild(verseDiv);
        });
    } else {
        versesContainer.innerHTML = `<p>No verses found for the selected range.</p>`;
    }
}
let chart;  // Store the chart instance globally to allow proper destruction



// Function to initialize and update the chart with device counts
function updateChart(deviceCounts, bookName) {
    console.log(deviceCounts); // Log to check the data structure

    const labels = Object.keys(deviceCounts);
    const data = Object.values(deviceCounts);

    // Check if the canvas exists
    const ctx = document.getElementById('deviceChart');
    if (!ctx) {
        console.error("Canvas element not found!");
        return;
    }

    const canvasContext = ctx.getContext('2d');

    if (chart) {
        chart.destroy();  // Destroy previous chart instance if it exists
    }

    // Initialize and create the chart
    chart = new Chart(canvasContext, {
        type: 'bar',
        data: {
            labels: labels,
            datasets: [{
                label: `Literary Devices in Bible`,
                data: data,
                backgroundColor: [
                    'rgb(55, 255, 0)',
                    '#add8e6',
                    'rgb(255, 165, 0)',
                    'rgb(255, 105, 180)',
                    'rgb(255, 255, 0)',
                    'rgb(176, 224, 230)',
                    'rgb(123, 104, 238)',
                    'rgb(255, 0, 0)'
                ],
                borderColor: 'rgba(0, 0, 0, 0.1)',
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Number of Occurrences'
                    }
                }
            }
        }
    });
}

// Function to count devices in a given book or section
function countDevicesInBook(bookName) {
    const deviceCounts = {
        'waw-explicativum': 0,
        'hendiadys': 0,
        'synecdoche': 0,
        'merism': 0,
        'wordplay': 0,
        'euphemism': 0,
        'simile': 0,
        'ambiguity': 0,
        'hapax': 0
    };

    // Loop through versesData and count occurrences of each device for the selected book
    versesData.forEach(row => {
        const [book, chapter, verse, text, device] = row;
        if (book === bookName && device && deviceCounts.hasOwnProperty(device.toLowerCase())) {
            deviceCounts[device.toLowerCase()]++;
        }
    });

    return deviceCounts;
}

// Function to display the chart for a selected book or section
function displayChartForBook(bookName) {
    const deviceCounts = countDevicesInBook(bookName);
    updateChart(deviceCounts, bookName);
}


// Example usage (this part depends on when you want to render the chart)
// Call this function after your data is loaded and ready
// Replace 'Genesis' with the book name or section you are working with
document.addEventListener('DOMContentLoaded', function () {
    // Example call to display chart for "Genesis"
    displayChartForBook('Genesis');

    const toggleChartBtn = document.getElementById('toggleChartBtn');
    const chartContainer = document.getElementById('chartContainer');

    // Add event listener to the chart toggle button
    toggleChartBtn.addEventListener('click', function () {
        // Toggle chart visibility
        if (chartContainer.style.display === 'none') {
            chartContainer.style.display = 'block'; // Show the chart
            toggleChartBtn.textContent = 'Hide Chart'; // Update button text
        } else {
            chartContainer.style.display = 'none'; // Hide the chart
            toggleChartBtn.textContent = 'Show Chart'; // Update button text
        }
    });

    // Initially update the chart when the page loads (if needed)
    updateGroupedChart(); // Call this to create the chart, it will remain hidden until toggled

    // Handle form visibility toggle and close button
    const formContainer = document.getElementById('formContainer');
    const toggleFormBtn = document.querySelector('.verse-plus-btn'); // Assuming there's only one "+" button
    const closeFormBtn = document.getElementById('closeFormBtn');

    // Event listener for the "+" button to open/close the form and toggle between + and X
    toggleFormBtn.addEventListener('click', function () {
        if (formContainer.style.display === 'none' || formContainer.style.display === '') {
            formContainer.style.display = 'block'; // Show the form
            toggleFormBtn.innerHTML = 'X'; // Change "+" to "X"
            toggleFormBtn.style.backgroundColor = '#f44336'; // Change background to red
        } else {
            formContainer.style.display = 'none'; // Hide the form
            toggleFormBtn.innerHTML = '+'; // Change "X" back to "+"
            toggleFormBtn.style.backgroundColor = ''; // Reset background color
        }
    });

    // Event listener for the "Close" button to hide the form and reset "+" button
    closeFormBtn.addEventListener('click', function () {
        formContainer.style.display = 'none'; // Hide the form
        toggleFormBtn.innerHTML = '+'; // Change "X" back to "+"
        toggleFormBtn.style.backgroundColor = ''; // Reset background color
    });
});

// Function to update the suggestion form with the adjacent verse
function updateFormWithVerse(verseText) {
    const baseUrl = 'https://docs.google.com/forms/d/e/1FAIpQLSf0pGZFjskpi5fASZ3aGKk0Ormp2qH1aggCRiu2pq5X9SuCbQ/viewform?embedded=true';
    const verseParam = `&entry.123456789=${encodeURIComponent(verseText)}`; // Replace entry.123456789 with your form's field ID
    document.getElementById('suggestionForm').src = baseUrl + verseParam;
}

// Add event listeners to each verse for hover or click
document.querySelectorAll('.verse').forEach(verseElement => {
    verseElement.addEventListener('mouseover', function() {
        const verseText = this.textContent || this.innerText; // Get verse text
        updateFormWithVerse(verseText); // Update form with the verse
    });
});

// Toggle form visibility with "+" button
document.getElementById('toggleFormBtn').addEventListener('click', function() {
    const formContainer = document.getElementById('formContainer');
    if (formContainer.style.display === 'none' || formContainer.style.display === '') {
        formContainer.style.display = 'block'; // Show the form
    } else {
        formContainer.style.display = 'none'; // Hide the form
    }
});

function toggleFormVisibility(verseKey = null) {
    const formContainer = document.getElementById('formContainer');

    // Toggle the form visibility
    if (formContainer.style.display === 'none' || formContainer.style.display === '') {
        if (verseKey) {
            prefillGoogleForm(verseKey);  // Prefill the form with the selected verse (only when a verse is provided)
        }
        formContainer.style.display = 'block'; // Show the form
    } else {
        formContainer.style.display = 'none'; // Hide the form
    }
}


    </script>
</body>
</html>